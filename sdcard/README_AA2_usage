/******************************************************************************
* Copyright (C) 2010 - 2020 Xilinx, Inc. All rights reserved.
* SPDX-License-Identifier: Apache-2.0
******************************************************************************/


1. File structure:
    The application is installed as:
        Binary File: => /opt/xilinx/bin
                                        aibox_aa2                               main app

        configuration File: => /opt/xilinx/share/aibox_aa2
                                        ped_pp.json                 Config of preprocess for refinedet.
                                        refinedet.json              Config of refinedet.
                                        crop.json                   Config of cropping for reid.
                                        reid.json                   Config of reid.
                                        draw_reid.json              Config of final results drawing.
        Example video files: => /usr/share/somapp/movies/AA2

2. How to run application:
    0) Prerequisites:
       a) Monitor:
          This application needs 4K monitor, so that up to 4 channels of 1080p video could be displayed.
          Before booting the board, please connect the monitor to the board via either DP or HDMI port.
       b) Enable the 4K display:
          Run following command in terminal:
            modetest -M xlnx -D 80000000.v_mix -s 52@40:3840x2160@NV16
          This step may remove later.

    1) Setup RTSP server:
       a) If no RTSP server on hand, smartcam_aa1 can be used as the RTSP server on the AA2 platform, with -n option, which turn off 
          the server side AI inference.
          e.g. 
            smartcam_aa1 -f /usr/share/somapp/movies/AA2/AA2-park.nv12.30fps.1080p.h264 -W 1920 -H 1080 -r 30 -t rtsp -p 5000 -n &
            console output example:
                stream ready at:
                    rtsp://192.168.33.123:5000/test
          If using a direct connection (no DHCP) see AA1 read me on how to set IP address.
          To setup multiple servers you can use different "-p port" option to get different rtsp addresses.
          * Please expect a video freeze after some time if you use this SOM as RTSP server and leave AA2 application running for 
          extended period of time.
       b) Alternatively, you may also use other RTSP sources, such as an IP camera. 
    2) Run AA2 application:
       a) Run one channel with one process:
            aibox_aa2 -s rtsp://192.168.33.123:5000/test -t rtsp -p 0 
       b) Run multiple channels together with one process:
            aibox_aa2 -s rtsp://192.168.33.123:5000/test -t rtsp -p 2 
                      -s /usr/share/somapp/movies/AA2/AA2-shop.nv12.30fps.1080p.h264 -t file -p 1
       c) Only one aibox_aa2 process could be actually running, because it requires locked access to DPU, and there is just one in aibox platform.

    3) Notice:
       a) When you use smartcam_aa1 as file based RTSP server as 2.1).a) states or use file type source, because the video file is played in an infinite loop,
          you may notice that when a new loop starts the tracking ID of the same person will change to a new one. This is not the algorithm issue or bug, but 
          because the algorithm will take the motion trail of the object into account, so a sudden change of scene will cause the generation of the new ID.

3. Command Option:
   Usage:
     aibox_aa2 [OPTION?] - AI Application of pedestrian + reid + tracking for multi RTSP streams, on SoM board of Xilinx.
   
   Help Options:
     -h, --help                                       Show help options
     --help-all                                       Show all help options
     --help-gst                                       Show GStreamer Options

   Application Options:
     -s, --src=[rtsp://server:port/id |file path]     URI of rtsp src, or location of h264|h265 video file. Must set. Can set up to 4 times
     -t, --srctype=[f|file, r|rtsp]                   Type of the input source: file (f)|rtsp (r). Optional. Can set up to 4 times.
     -e, --srcenc=[h264|h265]                         Encoding type of the input source. Optional. Can set up to 4 times.
     -p, --pos=[0|1|2|3]                              Location of the display in the 4 grids of 4k monitor. Optional. 
                                                      0: top left, 1: top right, 2: bottom left, 3: bottom right. Optional. Can set up to 4 times.
     -R, --report                                     Report fps
        
